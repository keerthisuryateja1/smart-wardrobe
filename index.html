<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Wardrobe Stylist - Fresh Design</title>
    <style>
        :root {
            --primary-color: #008080; /* Teal */
            --secondary-color: #FFA726; /* Amber */
            --accent-color: #FF7043; /* Coral */
            --background-color: #F4F6F8;
            --card-background: #FFFFFF;
            --text-color: #333333;
            --muted-text-color: #666666;
            --border-color: #E0E0E0;
            --border-radius: 8px;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --transition-speed: 0.3s;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Roboto', 'Segoe UI', sans-serif;
        }

        body {
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            padding: 20px;
        }

        .app-container {
            background-color: var(--card-background);
            width: 100%;
            max-width: 900px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .app-header {
            background-color: var(--primary-color);
            color: white;
            padding: 25px;
            text-align: center;
        }

        .app-header h1 {
            margin-bottom: 5px;
            font-size: 28px;
            font-weight: 500;
        }
        .app-header p {
            font-size: 16px;
            opacity: 0.9;
        }

        .progress-tracker {
            display: flex;
            justify-content: space-around;
            padding: 20px 15px;
            background-color: #f0f0f0;
            border-bottom: 1px solid var(--border-color);
        }

        .step-indicator {
            display: flex;
            flex-direction: column;
            align-items: center;
            font-size: 12px;
            color: var(--muted-text-color);
            position: relative;
            flex: 1;
            text-align: center;
        }
        
        .step-indicator .step-number {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: #ccc;
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            margin-bottom: 5px;
            transition: background-color var(--transition-speed);
            z-index: 1;
        }

        .step-indicator.active .step-number,
        .step-indicator.completed .step-number {
            background-color: var(--primary-color);
        }
        
        .step-indicator.active .step-label {
            color: var(--primary-color);
            font-weight: bold;
        }

        .progress-line {
            position: absolute;
            top: 15px; /* Align with center of step number */
            left: 50%;
            width: 100%;
            height: 3px;
            background-color: #ccc;
            z-index: 0;
        }
        .step-indicator:not(:first-child) .progress-line-segment {
            position: absolute;
            top: 15px;
            right: 50%; /* from center of current step to center of previous */
            width: 100%;
            height: 3px;
            background-color: #ccc;
            z-index: 0;
            transition: background-color var(--transition-speed);
        }
        .step-indicator.completed .progress-line-segment {
             background-color: var(--primary-color);
        }


        .step-content {
            padding: 30px;
            min-height: 400px; /* Adjust as needed */
        }

        .step {
            display: none;
            animation: fadeIn var(--transition-speed) ease-in-out;
        }

        .step.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .step h2 {
            font-size: 24px;
            color: var(--primary-color);
            margin-bottom: 10px;
        }
        .step p.description {
            margin-bottom: 25px;
            color: var(--muted-text-color);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-color);
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            font-size: 16px;
            transition: border-color var(--transition-speed), box-shadow var(--transition-speed);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(0, 128, 128, 0.2);
        }

        .btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: background-color var(--transition-speed), transform var(--transition-speed);
            text-decoration: none;
            display: inline-block;
        }

        .btn:hover {
            background-color: #006666; /* Darker Teal */
            transform: translateY(-2px);
        }
        
        .btn:disabled {
            background-color: #B0BEC5; /* Light grey for disabled state */
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background-color: #90A4AE; /* Grey Blue */
        }
        .btn-secondary:hover {
            background-color: #78909C;
        }
        
        .app-footer {
            padding: 20px 30px;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            background-color: #f9f9f9;
        }

        /* Gender Selection Cards */
        .gender-selection-container {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 40px;
        }
        .gender-card {
            background-color: var(--card-background);
            padding: 25px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            text-align: center;
            cursor: pointer;
            transition: all var(--transition-speed) ease;
            border: 2px solid transparent;
            width: 200px;
        }
        .gender-card:hover {
            transform: translateY(-5px);
            border-color: var(--secondary-color);
        }
        .gender-card.selected {
            border-color: var(--primary-color);
            box-shadow: 0 6px 15px rgba(0, 128, 128, 0.2);
        }
        .gender-card .icon {
            font-size: 50px;
            margin-bottom: 15px;
            color: var(--primary-color);
        }
        .gender-card h3 {
            font-size: 20px;
            color: var(--text-color);
        }

        /* Option Grids (for materials, styles, accessories) */
        .options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 15px;
        }
        .option-card {
            background-color: var(--card-background);
            padding: 15px;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: all var(--transition-speed) ease;
            display: flex;
            align-items: center;
        }
        .option-card:hover {
            border-color: var(--secondary-color);
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        .option-card.selected {
            border-color: var(--primary-color);
            background-color: rgba(0, 128, 128, 0.05);
        }
        .option-card input[type="checkbox"] {
            margin-right: 12px;
            width: 18px;
            height: 18px;
            accent-color: var(--primary-color);
        }
        .option-card .emoji {
            font-size: 20px;
            margin-right: 8px;
        }

        /* Color Selection */
        .colors-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 15px;
        }
        .color-option {
            display: flex;
            align-items: center;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: all var(--transition-speed) ease;
        }
        .color-option:hover {
            border-color: var(--secondary-color);
        }
        .color-option.selected {
            border-color: var(--primary-color);
            background-color: rgba(0, 128, 128, 0.05);
        }
        .color-dot {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            margin-right: 12px;
            border: 1px solid rgba(0,0,0,0.1);
        }

        /* Skin Tone Selector */
        .skin-tone-selector {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            flex-wrap: wrap;
        }
        .skin-tone-option {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all var(--transition-speed) ease;
        }
        .skin-tone-option:hover {
            transform: scale(1.1);
        }
        .skin-tone-option.selected {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px var(--primary-color);
        }

        /* Avatar Preview */
        .avatar-upload-container {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        .avatar-preview {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background-color: #e0e0e0;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            border: 2px solid var(--border-color);
        }
        .avatar-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .avatar-preview span {
            color: var(--muted-text-color);
            font-size: 14px;
        }
        #avatar-upload-input {
            display: none;
        }
        .upload-btn-label {
             background-color: var(--secondary-color);
        }
        .upload-btn-label:hover {
             background-color: #E69500;
        }

        /* Fiber Categories */
        .fiber-category {
            margin-bottom: 30px;
        }
        .fiber-category h3 {
            font-size: 18px;
            color: var(--text-color);
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 8px;
            margin-bottom: 15px;
        }

        /* Summary Page */
        .summary-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        @media (min-width: 768px) {
            .summary-grid {
                grid-template-columns: 1fr 1fr;
            }
        }
        .summary-card {
            background-color: #fdfdfd;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            padding: 20px;
        }
        .summary-card h3 {
            color: var(--primary-color);
            margin-bottom: 15px;
            font-size: 18px;
        }
        .summary-item {
            display: flex;
            margin-bottom: 10px;
            font-size: 15px;
        }
        .summary-item .label {
            font-weight: 500;
            width: 120px;
            color: var(--text-color);
        }
        .summary-item .value {
            color: var(--muted-text-color);
            flex: 1;
        }

        .wardrobe-output-container {
            margin-top: 30px;
        }
        .wardrobe-category-section {
            margin-bottom: 30px;
        }
        .wardrobe-category-section h3 {
            font-size: 20px;
            color: var(--primary-color);
            margin-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
        }
        .wardrobe-items-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 20px;
        }
        .wardrobe-item-card {
            background-color: var(--card-background);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            padding: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.03);
        }
        .wardrobe-item-card h4 {
            font-size: 17px;
            color: var(--text-color);
            margin-bottom: 8px;
        }
        .wardrobe-item-card .details p {
            font-size: 14px;
            color: var(--muted-text-color);
            margin-bottom: 4px;
        }
        
        .export-options-container {
            margin-top: 20px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <header class="app-header">
            <h1>Smart Wardrobe Stylist</h1>
            <p>Craft Your Personalized Style Guide (Rule-Based)</p>
        </header>

        <div class="progress-tracker" id="progress-tracker">
            <!-- Step indicators will be dynamically generated by JS -->
        </div>

        <main class="step-content">
            <!-- STEP 1: GENDER -->
            <section class="step active" data-step="1">
                <h2>Step 1: Select Your Gender</h2>
                <p class="description">This helps us tailor suggestions appropriately.</p>
                <div class="gender-selection-container">
                    <div class="gender-card" id="gender-male" onclick="selectGender('male')">
                        <div class="icon">♂️</div>
                        <h3>Male</h3>
                    </div>
                    <div class="gender-card" id="gender-female" onclick="selectGender('female')">
                        <div class="icon">♀️</div>
                        <h3>Female</h3>
                    </div>
                </div>
            </section>

            <!-- STEP 2: PERSONALIZATION -->
            <section class="step" data-step="2">
                <h2>Step 2: Personal Details</h2>
                <p class="description">Tell us a bit about yourself for a more personalized experience.</p>
                <form id="personalization-form">
                    <div class="form-group">
                        <label for="name">Name</label>
                        <input type="text" id="name" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="age">Age</label>
                        <input type="number" id="age" class="form-control" min="1" max="120" required>
                    </div>
                    <div class="form-group">
                        <label for="location">Location (City/Country)</label>
                        <input type="text" id="location" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label>Skin Tone</label>
                        <div class="skin-tone-selector">
                            <div class="skin-tone-option" style="background-color: #FFFAF0;" onclick="selectSkinTone(this, '#FFFAF0')"></div>
                            <div class="skin-tone-option" style="background-color: #F6E0B5;" onclick="selectSkinTone(this, '#F6E0B5')"></div>
                            <div class="skin-tone-option" style="background-color: #E8C28D;" onclick="selectSkinTone(this, '#E8C28D')"></div>
                            <div class="skin-tone-option" style="background-color: #D19C4C;" onclick="selectSkinTone(this, '#D19C4C')"></div>
                            <div class="skin-tone-option" style="background-color: #B07C45;" onclick="selectSkinTone(this, '#B07C45')"></div>
                            <div class="skin-tone-option" style="background-color: #8B572A;" onclick="selectSkinTone(this, '#8B572A')"></div>
                            <div class="skin-tone-option" style="background-color: #5E3D28;" onclick="selectSkinTone(this, '#5E3D28')"></div>
                            <div class="skin-tone-option" style="background-color: #3C2A21;" onclick="selectSkinTone(this, '#3C2A21')"></div>
                        </div>
                        <input type="hidden" id="skin-tone-value">
                    </div>
                    <div class="form-group">
                        <label for="avatar-upload-input">Upload Avatar (Optional)</label>
                        <div class="avatar-upload-container">
                            <div class="avatar-preview" id="avatar-preview-box"><span>Preview</span></div>
                            <label for="avatar-upload-input" class="btn upload-btn-label">Choose File</label>
                            <input type="file" id="avatar-upload-input" accept="image/*" onchange="previewAvatar(event)">
                        </div>
                    </div>
                </form>
            </section>

            <!-- STEP 3: MATERIAL PREFERENCES -->
            <section class="step" data-step="3">
                <h2>Step 3: Material Preferences</h2>
                <p class="description">Choose the fabric types you prefer.</p>
                <div class="fiber-category">
                    <h3>Natural Fibers</h3>
                    <div class="options-grid" id="natural-fibers-grid">
                        <!-- JS will populate -->
                    </div>
                </div>
                <div class="fiber-category">
                    <h3>Synthetic Fibers</h3>
                    <div class="options-grid" id="synthetic-fibers-grid">
                        <!-- JS will populate -->
                    </div>
                </div>
                 <div class="fiber-category">
                    <h3>Common Materials</h3>
                    <div class="options-grid" id="common-materials-grid">
                        <!-- JS will populate -->
                    </div>
                </div>
            </section>

            <!-- STEP 4: COLOR PREFERENCES -->
            <section class="step" data-step="4">
                <h2>Step 4: Color Preferences</h2>
                <p class="description">Select your favorite color families.</p>
                <div class="colors-grid" id="colors-grid-container">
                    <!-- JS will populate -->
                </div>
            </section>

            <!-- STEP 5: STYLE PREFERENCES -->
            <section class="step" data-step="5">
                <h2>Step 5: Style Preferences</h2>
                <p class="description">What styles resonate with you?</p>
                <div class="options-grid" id="styles-grid-container">
                    <!-- JS will populate -->
                </div>
            </section>

            <!-- STEP 6: ACCESSORIES (MALE) -->
            <section class="step" data-step="6" id="step-6-male">
                <h2>Step 6: Men's Accessories</h2>
                <p class="description">Select accessory categories you like.</p>
                <div class="options-grid" id="male-accessories-grid">
                    <!-- JS will populate -->
                </div>
            </section>

            <!-- STEP 6: ACCESSORIES (FEMALE) -->
            <section class="step" data-step="6" id="step-6-female">
                <h2>Step 6: Women's Accessories</h2>
                <p class="description">Select accessory categories you like.</p>
                <div class="options-grid" id="female-accessories-grid">
                    <!-- JS will populate -->
                </div>
            </section>

            <!-- STEP 7: SUMMARY & OUTPUT -->
            <section class="step" data-step="7">
                <h2>Your Personalized Wardrobe Guide</h2>
                <p class="description">Here are suggestions based on your preferences.</p>
                
                <div class="summary-grid">
                    <div class="summary-card">
                        <h3>Your Profile</h3>
                        <div class="summary-item"><span class="label">Name:</span><span class="value" id="summary-name"></span></div>
                        <div class="summary-item"><span class="label">Age:</span><span class="value" id="summary-age"></span></div>
                        <div class="summary-item"><span class="label">Location:</span><span class="value" id="summary-location"></span></div>
                        <div class="summary-item"><span class="label">Gender:</span><span class="value" id="summary-gender"></span></div>
                        <div class="summary-item"><span class="label">Skin Tone:</span><span class="value" id="summary-skin-tone"></span></div>
                    </div>
                    <div class="summary-card">
                        <h3>Your Preferences</h3>
                        <div class="summary-item"><span class="label">Materials:</span><span class="value" id="summary-materials"></span></div>
                        <div class="summary-item"><span class="label">Colors:</span><span class="value" id="summary-colors"></span></div>
                        <div class="summary-item"><span class="label">Styles:</span><span class="value" id="summary-styles"></span></div>
                        <div class="summary-item"><span class="label">Accessories:</span><span class="value" id="summary-accessories"></span></div>
                    </div>
                </div>

                <div class="wardrobe-output-container" id="wardrobe-output">
                    <!-- Wardrobe items will be loaded here by JS -->
                </div>

                <div class="export-options-container">
                    <button class="btn" onclick="exportToPDF()">Export as PDF</button>
                    <button class="btn" onclick="exportToCSV()">Export as CSV</button>
                    <button class="btn" onclick="printWardrobe()">Print</button>
                </div>
            </section>
        </main>

        <footer class="app-footer">
            <button class="btn btn-secondary" id="prev-btn" onclick="prevStep()" style="display: none;">Back</button>
            <div><!-- Spacer --></div>
            <button class="btn" id="next-btn" onclick="nextStep()" disabled>Next</button>
            <button class="btn" id="finish-btn" onclick="finishSetup()" style="display: none;">View My Wardrobe</button>
            <button class="btn btn-secondary" id="start-over-btn" onclick="startOver()" style="display: none;">Start Over</button>
        </footer>
    </div>

    <script>
        let currentStep = 1;
        const totalSteps = 7; // Including summary page
        const userData = {
            gender: '',
            name: '',
            age: '',
            location: '',
            skinTone: '',
            avatar: null,
            materials: [],
            colors: [],
            styles: [],
            accessories: []
        };

        const stepDefinitions = [
            { number: 1, label: "Gender" },
            { number: 2, label: "Details" },
            { number: 3, label: "Materials" },
            { number: 4, label: "Colors" },
            { number: 5, label: "Styles" },
            { number: 6, label: "Accessories" },
            { number: 7, label: "Summary" }
        ];

        // Data for options
        const materialOptions = {
            natural: [
                { value: "Leather", emoji: "🐾" }, { value: "Cotton", emoji: "☁️" },
                { value: "Wool", emoji: "🐑" }, { value: "Linen", emoji: "🌿" },
                { value: "Silk", emoji: "🦋" }
            ],
            synthetic: [
                { value: "Polyester", emoji: "🧪" }, { value: "Nylon", emoji: "🔗" },
                { value: "Spandex", emoji: "🤸" }, { value: "Rayon", emoji: "✨" }
            ],
            common: [
                { value: "Denim", emoji: "👖" }, { value: "Viscose", emoji: "🍃" },
                { value: "Satin", emoji: "💫" }, { value: "Chiffon", emoji: "🌬️" },
                { value: "Crepe", emoji: "📜" }, { value: "Lace", emoji: "🌸" }
            ]
        };

        const colorFamilyOptions = [
            { name: "Black Family", code: "#000000", emoji: "🖤" },
            { name: "White Family", code: "#FFFFFF", emoji: "🤍" },
            { name: "Grey Family", code: "#808080", emoji: "🩶" },
            { name: "Brown Family", code: "#8B4513", emoji: "🤎" },
            { name: "Red Family", code: "#FF0000", emoji: "❤️" },
            { name: "Yellow Family", code: "#FFFF00", emoji: "💛" },
            { name: "Orange Family", code: "#FFA500", emoji: "🧡" },
            { name: "Green Family", code: "#008000", emoji: "💚" },
            { name: "Blue Family", code: "#0000FF", emoji: "💙" },
            { name: "Purple Family", code: "#800080", emoji: "💜" },
            { name: "Pink Family", code: "#FFC0CB", emoji: "💖" },
            { name: "Gold & Metallics", code: "linear-gradient(45deg, #FFD700, #C0C0C0)", emoji: "✨" }
        ];

        const styleOptions = [
            { value: "Casual", emoji: "🟢" }, { value: "Formal", emoji: "🟡" },
            { value: "Traditional", emoji: "🧡" }, { value: "Stylish", emoji: "🔴" },
            { value: "Minimalist", emoji: "🟤" }, { value: "Streetwear", emoji: "🟣" },
            { value: "Business Casual", emoji: "⚫" }, { value: "Ethnic", emoji: "🟠" },
            { value: "Sport Casual", emoji: "🔵" }, { value: "Loungewear", emoji: "🟩" },
            { value: "Outerwear", emoji: "🟥" }, { value: "Sportswear", emoji: "🟨" }
        ];
        
        const accessoryOptions = {
            male: [
                { value: "Watches", emoji: "⌚" }, { value: "Sunglasses", emoji: "🕶️" },
                { value: "Footwear", emoji: "👞" }, { value: "Headwear", emoji: "🧢" },
                { value: "Jewelry", emoji: "💍" }, { value: "Ties", emoji: "👔" },
                { value: "Scarves", emoji: "🧣" }, { value: "Bags", emoji: "👜" },
                { value: "Gloves", emoji: "🧤" }, { value: "Belts", emoji: "🧵" },
                { value: "Pocket Squares", emoji: "📌" }, { value: "Cufflinks", emoji: "🟠" }
            ],
            female: [
                { value: "Jewelry", emoji: "💎" }, { value: "Bags", emoji: "👜" },
                { value: "Headwear", emoji: "🎀" }, { value: "Sunglasses", emoji: "🕶️" },
                { value: "Footwear", emoji: "👠" }, { value: "Hats", emoji: "👒" },
                { value: "Scarves", emoji: "🧣" }, { value: "Gloves", emoji: "🧤" },
                { value: "Belts", emoji: "🧵" }, { value: "Hair Accessories", emoji: "🧸" }
            ]
        };

        // Predefined wardrobe items (non-AI)
        const wardrobeItemsDB = {
            male: {
                Casual: [{ name: "Plain T-shirt", materials: ["Cotton"], colors: ["White Family", "Black Family", "Grey Family"] }, { name: "Jeans", materials: ["Denim"], colors: ["Blue Family"] }, { name: "Hoodie", materials: ["Cotton"], colors: ["Grey Family", "Black Family"] }, { name: "Sneakers", materials: ["Leather", "Synthetic"], colors: ["White Family", "Black Family"] }],
                Formal: [{ name: "Dress Shirt", materials: ["Cotton"], colors: ["White Family", "Blue Family"] }, { name: "Suit Pants", materials: ["Wool"], colors: ["Black Family", "Grey Family", "Blue Family"] }, { name: "Blazer", materials: ["Wool"], colors: ["Black Family", "Grey Family", "Blue Family"] }, { name: "Leather Shoes", materials: ["Leather"], colors: ["Black Family", "Brown Family"] }],
                Traditional: [{ name: "Kurta", materials: ["Cotton", "Silk"], colors: ["White Family", "Beige Family", "Blue Family"] }, { name: "Nehru Jacket", materials: ["Silk", "Cotton"], colors: ["Black Family", "Blue Family", "Gold & Metallics"] }, { name: "Dhoti", materials: ["Cotton"], colors: ["White Family"] }],
                Stylish: [{ name: "Patterned Shirt", materials: ["Cotton"], colors: ["Multi-color"] }, { name: "Slim Fit Chinos", materials: ["Cotton"], colors: ["Beige Family", "Blue Family", "Green Family"] }, { name: "Leather Jacket", materials: ["Leather"], colors: ["Black Family", "Brown Family"] }],
                Minimalist: [{ name: "Basic Tee", materials: ["Cotton"], colors: ["Black Family", "White Family", "Grey Family"] }, { name: "Simple Trousers", materials: ["Cotton"], colors: ["Black Family", "Navy Blue"] }, { name: "Canvas Shoes", materials: ["Cotton"], colors: ["White Family", "Black Family"] }],
                Streetwear: [{ name: "Graphic Tee", materials: ["Cotton"], colors: ["Black Family", "White Family"] }, { name: "Cargo Pants", materials: ["Cotton"], colors: ["Olive Green", "Black Family", "Beige Family"] }, { name: "High-top Sneakers", materials: ["Leather", "Synthetic"], colors: ["Multi-color"] }],
                "Business Casual": [{ name: "Polo Shirt", materials: ["Cotton"], colors: ["Blue Family", "Black Family", "White Family"] }, { name: "Chinos", materials: ["Cotton"], colors: ["Beige Family", "Navy Blue", "Grey Family"] }, { name: "Loafers", materials: ["Leather"], colors: ["Brown Family", "Black Family"] }],
                Ethnic: [{ name: "Sherwani", materials: ["Silk"], colors: ["Gold & Metallics", "Red Family", "Blue Family"] }, { name: "Kurta Pajama", materials: ["Cotton", "Silk"], colors: ["White Family", "Beige Family"] }, { name: "Mojari", materials: ["Leather"], colors: ["Gold & Metallics", "Brown Family"] }]
            },
            female: {
                Casual: [{ name: "T-shirt", materials: ["Cotton"], colors: ["White Family", "Black Family", "Grey Family"] }, { name: "Jeans", materials: ["Denim"], colors: ["Blue Family"] }, { name: "Cardigan", materials: ["Cotton", "Wool"], colors: ["Grey Family", "Black Family"] }, { name: "Sneakers", materials: ["Leather", "Synthetic"], colors: ["White Family", "Black Family"] }],
                Formal: [{ name: "Blouse", materials: ["Cotton", "Silk"], colors: ["White Family", "Black Family"] }, { name: "Pencil Skirt", materials: ["Wool", "Cotton"], colors: ["Black Family", "Grey Family", "Blue Family"] }, { name: "Blazer", materials: ["Wool"], colors: ["Black Family", "Grey Family", "Blue Family"] }, { name: "Heels", materials: ["Leather"], colors: ["Black Family", "Nude"] }],
                Traditional: [{ name: "Saree", materials: ["Silk", "Cotton"], colors: ["Red Family", "Gold & Metallics", "Blue Family"] }, { name: "Salwar Kameez", materials: ["Cotton", "Silk"], colors: ["Multi-color"] }, { name: "Lehenga", materials: ["Silk"], colors: ["Red Family", "Pink Family", "Gold & Metallics"] }],
                Stylish: [{ name: "Wrap Dress", materials: ["Cotton", "Rayon"], colors: ["Multi-color"] }, { name: "Jumpsuit", materials: ["Cotton", "Rayon"], colors: ["Black Family", "Blue Family"] }, { name: "Statement Jacket", materials: ["Leather", "Denim"], colors: ["Multi-color"] }],
                Minimalist: [{ name: "Shift Dress", materials: ["Cotton"], colors: ["Black Family", "White Family", "Grey Family"] }, { name: "Simple Blouse", materials: ["Cotton"], colors: ["White Family", "Black Family"] }, { name: "Straight Pants", materials: ["Cotton"], colors: ["Black Family", "Navy Blue"] }],
                Streetwear: [{ name: "Oversized Tee", materials: ["Cotton"], colors: ["Black Family", "White Family"] }, { name: "High-waisted Pants", materials: ["Cotton", "Denim"], colors: ["Black Family", "Blue Family"] }, { name: "Platform Sneakers", materials: ["Leather", "Synthetic"], colors: ["White Family", "Black Family"] }]
            }
        };
        const accessoryMap = {
            male: { Watches: ["Analog watch", "Digital watch", "Smart watch"], Sunglasses: ["Aviator sunglasses", "Wayfarer sunglasses"], Footwear: ["Oxford shoes", "Loafers", "Sneakers"], Headwear: ["Baseball cap", "Beanie"], Jewelry: ["Wristband", "Chain"], Ties: ["Silk tie", "Bow tie"], Scarves: ["Wool scarf", "Cotton muffler"], Bags: ["Leather wallet", "Messenger bag"], Gloves: ["Leather gloves", "Winter gloves"], Belts: ["Leather belt", "Canvas belt"], "Pocket Squares": ["Silk pocket square", "Lapel pin"], Cufflinks: ["Metal cufflinks", "Wooden cufflinks"] },
            female: { Jewelry: ["Necklace", "Earrings", "Bracelet"], Bags: ["Crossbody bag", "Tote bag", "Clutch"], Headwear: ["Headband", "Hair scarf"], Sunglasses: ["Cat-eye sunglasses", "Oversized sunglasses"], Footwear: ["Pumps", "Flats", "Boots"], Hats: ["Fedora", "Sun hat"], Scarves: ["Silk scarf", "Wool shawl"], Gloves: ["Leather gloves", "Evening gloves"], Belts: ["Leather belt", "Waist chain"], "Hair Accessories": ["Hair clips", "Scrunchies"] }
        };
        
        document.addEventListener('DOMContentLoaded', () => {
            initProgressTracker();
            updateStepView();
            populateOptions();
        });

        function initProgressTracker() {
            const tracker = document.getElementById('progress-tracker');
            tracker.innerHTML = ''; // Clear existing
            stepDefinitions.forEach((stepDef, index) => {
                const stepIndicator = document.createElement('div');
                stepIndicator.classList.add('step-indicator');
                stepIndicator.dataset.stepTarget = stepDef.number;
                stepIndicator.innerHTML = `
                    ${index > 0 ? '<div class="progress-line-segment"></div>' : ''}
                    <div class="step-number">${stepDef.number}</div>
                    <div class="step-label">${stepDef.label}</div>
                `;
                tracker.appendChild(stepIndicator);
            });
        }
        
        function populateOptions() {
            // Materials
            populateGrid('natural-fibers-grid', materialOptions.natural, 'material', 'checkbox');
            populateGrid('synthetic-fibers-grid', materialOptions.synthetic, 'material', 'checkbox');
            populateGrid('common-materials-grid', materialOptions.common, 'material', 'checkbox');
            // Colors
            populateColorGrid('colors-grid-container', colorFamilyOptions);
            // Styles
            populateGrid('styles-grid-container', styleOptions, 'style', 'checkbox');
            // Accessories
            populateGrid('male-accessories-grid', accessoryOptions.male, 'accessory-male', 'checkbox');
            populateGrid('female-accessories-grid', accessoryOptions.female, 'accessory-female', 'checkbox');
        }

        function populateGrid(containerId, items, name, type) {
            const container = document.getElementById(containerId);
            items.forEach(item => {
                const card = document.createElement('div');
                card.classList.add('option-card');
                card.innerHTML = `
                    <input type="${type}" name="${name}" value="${item.value}" id="${name}-${item.value.replace(/\s+/g, '')}">
                    ${item.emoji ? `<span class="emoji">${item.emoji}</span>` : ''}
                    <label for="${name}-${item.value.replace(/\s+/g, '')}">${item.value}</label>
                `;
                card.onclick = () => {
                    const checkbox = card.querySelector(`input[type="${type}"]`);
                    checkbox.checked = !checkbox.checked;
                    card.classList.toggle('selected', checkbox.checked);
                    validateCurrentStep(); // Re-validate on selection
                };
                container.appendChild(card);
            });
        }
        
        function populateColorGrid(containerId, items) {
            const container = document.getElementById(containerId);
            items.forEach(item => {
                const option = document.createElement('div');
                option.classList.add('color-option');
                option.dataset.value = item.name;
                option.innerHTML = `
                    <div class="color-dot" style="background: ${item.code};"></div>
                    <span>${item.emoji} ${item.name}</span>
                `;
                option.onclick = () => {
                    option.classList.toggle('selected');
                    validateCurrentStep(); // Re-validate on selection
                };
                container.appendChild(option);
            });
        }


        function updateStepView() {
            // Hide all steps
            document.querySelectorAll('.step').forEach(stepEl => stepEl.classList.remove('active'));
            
            // Show current step (handle gender specific accessory page)
            let activeStepEl;
            if (currentStep === 6) {
                activeStepEl = document.getElementById(userData.gender === 'male' ? 'step-6-male' : 'step-6-female');
            } else {
                activeStepEl = document.querySelector(`.step[data-step="${currentStep}"]`);
            }
            if(activeStepEl) activeStepEl.classList.add('active');

            // Update progress tracker
            document.querySelectorAll('.progress-tracker .step-indicator').forEach((indicator, index) => {
                const stepNum = parseInt(indicator.dataset.stepTarget);
                indicator.classList.remove('active', 'completed');
                const lineSegment = indicator.querySelector('.progress-line-segment');

                if (stepNum < currentStep) {
                    indicator.classList.add('completed');
                    if(lineSegment) lineSegment.style.backgroundColor = 'var(--primary-color)';
                } else if (stepNum === currentStep) {
                    indicator.classList.add('active');
                     if(lineSegment) lineSegment.style.backgroundColor = 'var(--primary-color)'; // Line to current active
                } else {
                    if(lineSegment) lineSegment.style.backgroundColor = '#ccc'; // Reset future lines
                }
            });

            // Update button visibility and states
            document.getElementById('prev-btn').style.display = currentStep > 1 ? 'inline-block' : 'none';
            document.getElementById('next-btn').style.display = currentStep < 6 ? 'inline-block' : 'none'; // Next for steps 1-5
            document.getElementById('finish-btn').style.display = currentStep === 6 ? 'inline-block' : 'none'; // Finish for step 6
            document.getElementById('start-over-btn').style.display = currentStep === totalSteps ? 'inline-block' : 'none';
            
            if (currentStep === totalSteps) { // Summary page
                document.getElementById('prev-btn').style.display = 'inline-block'; // Allow going back from summary
                document.getElementById('next-btn').style.display = 'none';
                document.getElementById('finish-btn').style.display = 'none';
            }
            
            validateCurrentStep(); // Validate whenever view changes to enable/disable next/finish
        }
        
        function selectGender(gender) {
            userData.gender = gender;
            document.getElementById('gender-male').classList.remove('selected');
            document.getElementById('gender-female').classList.remove('selected');
            document.getElementById(`gender-${gender}`).classList.add('selected');
            validateCurrentStep();
        }

        function selectSkinTone(element, color) {
            userData.skinTone = color;
            document.querySelectorAll('.skin-tone-option').forEach(el => el.classList.remove('selected'));
            element.classList.add('selected');
            document.getElementById('skin-tone-value').value = color;
            validateCurrentStep();
        }

        function previewAvatar(event) {
            const file = event.target.files[0];
            if (file) {
                userData.avatar = file; // Store file object if needed, or URL
                const reader = new FileReader();
                reader.onload = e => {
                    document.getElementById('avatar-preview-box').innerHTML = `<img src="${e.target.result}" alt="Avatar">`;
                }
                reader.readAsDataURL(file);
            }
        }
        
        function collectDataForCurrentStep() {
            switch (currentStep) {
                case 2: // Personalization
                    userData.name = document.getElementById('name').value;
                    userData.age = document.getElementById('age').value;
                    userData.location = document.getElementById('location').value;
                    // skinTone already set by selectSkinTone
                    break;
                case 3: // Materials
                    userData.materials = Array.from(document.querySelectorAll('input[name="material"]:checked')).map(cb => cb.value);
                    break;
                case 4: // Colors
                    userData.colors = Array.from(document.querySelectorAll('.color-option.selected')).map(el => el.dataset.value);
                    break;
                case 5: // Styles
                    userData.styles = Array.from(document.querySelectorAll('input[name="style"]:checked')).map(cb => cb.value);
                    break;
                case 6: // Accessories
                    const accessoryType = userData.gender === 'male' ? 'accessory-male' : 'accessory-female';
                    userData.accessories = Array.from(document.querySelectorAll(`input[name="${accessoryType}"]:checked`)).map(cb => cb.value);
                    break;
            }
        }
        
        function validateCurrentStep() {
            let isValid = false;
            const nextButton = document.getElementById('next-btn');
            const finishButton = document.getElementById('finish-btn');

            switch (currentStep) {
                case 1: isValid = !!userData.gender; break;
                case 2:
                    isValid = document.getElementById('name').value.trim() !== '' &&
                              document.getElementById('age').value.trim() !== '' &&
                              document.getElementById('location').value.trim() !== '' &&
                              !!userData.skinTone;
                    break;
                case 3: isValid = document.querySelectorAll('input[name="material"]:checked').length > 0; break;
                case 4: isValid = document.querySelectorAll('.color-option.selected').length > 0; break;
                case 5: isValid = document.querySelectorAll('input[name="style"]:checked').length > 0; break;
                case 6:
                    const accessoryType = userData.gender === 'male' ? 'accessory-male' : 'accessory-female';
                    isValid = document.querySelectorAll(`input[name="${accessoryType}"]:checked`).length > 0;
                    break;
                default: isValid = true; // For summary page or unhandled steps
            }
            
            if (nextButton) nextButton.disabled = !isValid;
            if (finishButton) finishButton.disabled = !isValid;
            return isValid;
        }


        function nextStep() {
            if (!validateCurrentStep()) {
                alert('Please complete all required fields for this step.');
                return;
            }
            collectDataForCurrentStep();
            if (currentStep < 6) { // Max input step before summary logic
                currentStep++;
                updateStepView();
            }
             window.scrollTo(0, 0);
        }
        
        function finishSetup() { // Called from "View My Wardrobe" button on step 6
            if (!validateCurrentStep()) {
                alert('Please complete all required fields for this step.');
                return;
            }
            collectDataForCurrentStep();
            currentStep = totalSteps; // Move to summary page (step 7)
            generateWardrobeOutput();
            updateStepView();
            window.scrollTo(0, 0);
        }


        function prevStep() {
            if (currentStep > 1) {
                currentStep--;
                updateStepView();
            }
            window.scrollTo(0, 0);
        }

        function generateWardrobeOutput() {
            // Populate summary card
            document.getElementById('summary-name').textContent = userData.name || 'N/A';
            document.getElementById('summary-age').textContent = userData.age || 'N/A';
            document.getElementById('summary-location').textContent = userData.location || 'N/A';
            document.getElementById('summary-gender').textContent = userData.gender ? (userData.gender.charAt(0).toUpperCase() + userData.gender.slice(1)) : 'N/A';
            document.getElementById('summary-skin-tone').innerHTML = userData.skinTone ? `<div class="skin-tone-option" style="background-color:${userData.skinTone}; display:inline-block; vertical-align:middle;"></div> ${userData.skinTone}` : 'N/A';
            document.getElementById('summary-materials').textContent = userData.materials.join(', ') || 'N/A';
            document.getElementById('summary-colors').textContent = userData.colors.join(', ') || 'N/A';
            document.getElementById('summary-styles').textContent = userData.styles.join(', ') || 'N/A';
            document.getElementById('summary-accessories').textContent = userData.accessories.join(', ') || 'N/A';

            const outputContainer = document.getElementById('wardrobe-output');
            outputContainer.innerHTML = ''; // Clear previous

            let htmlContent = '';

            // Clothing Items
            const genderWardrobe = wardrobeItemsDB[userData.gender] || {};
            htmlContent += '<div class="wardrobe-category-section"><h3>Recommended Clothing</h3><div class="wardrobe-items-grid">';
            let clothingAdded = false;
            userData.styles.forEach(style => {
                if (genderWardrobe[style]) {
                    genderWardrobe[style].forEach(item => {
                        const matchesMaterial = item.materials.some(mat => userData.materials.includes(mat));
                        const matchesColor = item.colors.some(col => userData.colors.includes(col) || col === "Multi-color"); // Simplified color match
                        
                        if (matchesMaterial && matchesColor) { // Ensure material and color preference match
                            htmlContent += `
                                <div class="wardrobe-item-card">
                                    <h4>${item.name}</h4>
                                    <div class="details">
                                        <p>Style: ${style}</p>
                                        <p>Materials: ${item.materials.join(', ')}</p>
                                        <p>Suggested Colors: ${item.colors.join(', ')}</p>
                                    </div>
                                </div>`;
                            clothingAdded = true;
                        }
                    });
                }
            });
            if (!clothingAdded) htmlContent += "<p>No clothing items match all your preferences. Try broadening your material or color selections.</p>";
            htmlContent += '</div></div>';
            
            // Accessories
            const genderAccessories = accessoryMap[userData.gender] || {};
            htmlContent += '<div class="wardrobe-category-section"><h3>Recommended Accessories</h3><div class="wardrobe-items-grid">';
            let accessoriesAdded = false;
            userData.accessories.forEach(accCategory => {
                if (genderAccessories[accCategory]) {
                    genderAccessories[accCategory].forEach(item => {
                        htmlContent += `
                            <div class="wardrobe-item-card">
                                <h4>${item}</h4>
                                <div class="details"><p>Category: ${accCategory}</p></div>
                            </div>`;
                        accessoriesAdded = true;
                    });
                }
            });
             if (!accessoriesAdded) htmlContent += "<p>No accessories selected or match your preferences.</p>";
            htmlContent += '</div></div>';

            // Maintenance Tips (Generic)
            htmlContent += `
                <div class="wardrobe-category-section">
                    <h3>General Maintenance Tips</h3>
                    <div class="wardrobe-items-grid">
                        <div class="wardrobe-item-card"><h4>Fabric Care</h4><div class="details"><p>Follow care labels. Wash delicates gently. Air dry when possible.</p></div></div>
                        <div class="wardrobe-item-card"><h4>Storage</h4><div class="details"><p>Use appropriate hangers. Store clean and dry. Avoid overcrowding.</p></div></div>
                        <div class="wardrobe-item-card"><h4>Longevity</h4><div class="details"><p>Rotate items. Repair promptly. Invest in quality pieces.</p></div></div>
                    </div>
                </div>`;
            outputContainer.innerHTML = htmlContent;
        }

        function startOver() {
            // Reset userData
            Object.keys(userData).forEach(key => {
                if (Array.isArray(userData[key])) userData[key] = [];
                else if (typeof userData[key] === 'string') userData[key] = '';
                else userData[key] = null;
            });
            // Reset UI elements in forms (inputs, selections)
            document.querySelectorAll('input[type="text"], input[type="number"]').forEach(input => input.value = '');
            document.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
            document.querySelectorAll('.option-card.selected, .color-option.selected, .gender-card.selected, .skin-tone-option.selected').forEach(el => el.classList.remove('selected'));
            document.getElementById('avatar-preview-box').innerHTML = '<span>Preview</span>';
            document.getElementById('avatar-upload-input').value = ''; // Clear file input

            currentStep = 1;
            updateStepView();
            window.scrollTo(0,0);
        }
        
        // Placeholder export functions
        function exportToPDF() { alert('PDF Export: This would generate a PDF of your wardrobe summary.'); }
        function exportToCSV() { alert('CSV Export: This would generate a CSV file of your wardrobe items.'); }
        function printWardrobe() { window.print(); }

    </script>
</body>
</html>